<tal:block define="
  disp_infos python:here.calendar_getDispInformations(request);
  current_action disp_infos/current_action;
  calendar_disp disp_infos/disp;
  selected_day disp_infos/selected_day;
  viewed_day disp_infos/viewed_day;
  start_time disp_infos/start_time;
  end_time disp_infos/end_time;
  events_desc python:here.getEventsDesc(start_time, end_time, calendar_disp)
  ">
<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master">
<metal:block fill-slot="base">
  <base href="." tal:attributes="href string:${here/absolute_url}/" />
</metal:block>
<body>


<metal:block fill-slot="header">
  <tal:block condition="python:here.usertype == 'member'">
    <tal:block replace="python:mcat('_cal_Calendar_of_')">
      Calendar of
    </tal:block>
    <tal:block
      define="user_id here/id; user_props python:dtool.getEntry(user_id); fullname python:user_props and user_props.get(dtool.display_prop, user_id) or user_id;"
      replace ="fullname">
      Fullname
    </tal:block>
  </tal:block>
  <tal:block condition="python:here.usertype != 'member'"
    replace="python:mcat(here.title_or_id())">
    Ressource
  </tal:block>
</metal:block>

<metal:block fill-slot="header_plus"></metal:block>

<metal:block fill-slot="main"
  tal:define="can_add_evts python:mtool.checkPermission('Add portal content', here)">
  <tal:block condition="can_add_evts">
    <tal:block define="ev_dict here/getDeclinedCanceledEvents">
      <form name="calendar_delevents" method="POST"
        tal:define="canceled ev_dict/canceled"
        tal:condition="canceled">
        <input type="hidden" name="ids:list"
          tal:repeat="id canceled"
          tal:attributes="value id" />
        <input type="submit"
          tal:attributes="value python:mcat('_button_Remove canceled events_')" />
      </form>
      <form name="calendar_delevents" method="POST"
        tal:define="declined ev_dict/declined"
        tal:condition="declined">
        <input type="hidden" name="ids:list"
          tal:repeat="id declined"
          tal:attributes="value id" />
        <input type="submit"
          tal:attributes="value python:mcat('_button_Remove events you declined_')" />
      </form>
    </tal:block>
  </tal:block>
  <tal:block condition="python:mtool.checkPermission('Add portal content', here)">
    <tal:block define="pendings_count here/getPendingEventsCount"
      condition="pendings_count">
      <h3>
        <a href="calendar_pending_events">Pending requests:
          <tal:block replace="pendings_count">1</tal:block>
        </a>
      </h3>
    </tal:block>
  </tal:block>
  <metal:block use-macro="here/calendar_view_macros/macros/?calendar_disp" />
</metal:block>


</body>
</html>
</tal:block>

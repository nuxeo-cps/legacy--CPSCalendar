<tal:block define="create options/create|nothing;
  current_action python:create and 'addevent' or 'edit'">
<html metal:use-macro="here/main_template/macros/master">

<metal:block fill-slot="header">
  <tal:block condition="create"
    tal:replace="python:mcat('_Create_a_new_Event_')">
    Create a new event
  </tal:block>
  <tal:block condition="not:create">
    <tal:block replace="python:mcat('_Modify_(object name)_')">
      Modify
    </tal:block>
    «&nbsp;<span tal:replace="here/title_or_id">Title</span>&nbsp;»
  </tal:block>
</metal:block>

<metal:block fill-slot="header_plus" />

<metal:block fill-slot="main"
  tal:define="
    disp_infos python:here.calendar_getDispInformations(request);
    action python:create and 'calendar_addevent' or 'calendar_editevent';
    submit_value python:create and mcat('_button_create_') or mcat('_button_modify_');
    editevent python:create or here.canEditThisEvent();
    title python:create and mcat('_(document)_Untitled_') or here.title;
    location python:(not create) and here.location or '';
    event_status python:create and 'unconfirmed' or here.event_status;
    all_day python:(create and [request.form.get('all_day')] or [here.all_day])[0];
    from_date python:create and disp_infos['selected_day'] or here.from_date;
    from_date_day from_date/day;
    from_date_month from_date/month;
    from_date_year from_date/year;
    from_date_hour from_date/hour;
    from_date_minute python:int(from_date.minute()/15)*15;
    to_date python:create and from_date or here.to_date;
    to_date_day to_date/day;
    to_date_month to_date/month;
    to_date_year to_date/year;
    to_date_hour to_date/hour;
    to_date_hour python:(create and not all_day and to_date_hour+2) or to_date_hour;
    trim_hour python:create and not all_day and to_date_hour > 23;
    to_date_minute python:int(to_date.minute()/15)*15;
    to_date_hour python:not trim_hour and to_date_hour or 0;
    to_date_minute python:not trim_hour and to_date_minute or 0;
    attendees python:(not create) and here.attendees or [];
    transparent python:create and 0 or not not here.transparent;
    cat_info here/calendar_categories;
    categories cat_info/categories;
    cat_default cat_info/default;
    category python:create and cat_default or here.category;
  ">

  <tal:block condition="not:editevent" define="event nocall:here">
    <metal:block use-macro="here/calendar_macros/macros/event_view" />
  </tal:block>
  <tal:block condition="editevent">
    <form action="calendar_addevent_form" tal:condition="create">
      <input type="hidden" name="all_day:int"
        tal:attributes="value not:all_day" />
      <input type="submit"
        tal:attributes="value python:all_day and mcat('_Create a not all day_') or mcat('_Create an all day_')">
    </form>
    <form action="calendar_changeeventtype" tal:condition="not:create">
      <input type="hidden" name="all_day:int"
        tal:attributes="value not:all_day" />
      <input type="submit"
        tal:attributes="value python:all_day and mcat('_Change event to not all day_') or mcat('_Change event to all day_')">
    </form>
    <form tal:attributes="action action" method="POST">
      <metal:block use-macro="here/main_widgets/macros/form">
        <metal:block fill-slot="content">
          <metal:block use-macro="here/main_widgets/macros/form_property">
            <metal:block fill-slot="title"
              tal:content="python:mcat('_cal_prop_summary_')">
              Summary
            </metal:block>
            <metal:block fill-slot="content">
              <input name="title" size="40" tal:attributes="value title" />
            </metal:block>
          </metal:block>
          <metal:block use-macro="here/main_widgets/macros/form_property">
            <metal:block fill-slot="title"
              tal:content="python:mcat('_cal_prop_date_')">
              Date
            </metal:block>
            <metal:block fill-slot="content">
              <tal:block condition="all_day">
                <input type="hidden" name="all_day" value="on">
                <input type="hidden" name="from_date_hour"
                  tal:attributes="value from_date_hour" />
                <input type="hidden" name="from_date_minute"
                  tal:attributes="value from_date_minute" />
                <input type="hidden" name="to_date_hour"
                  tal:attributes="value to_date_hour" />
                <input type="hidden" name="to_date_minute"
                  tal:attributes="value to_date_minute" />
                <tal:block replace="python:mcat('_cal_date_From_')">
                  From
                </tal:block>
                <select name="from_date_day">
                  <option tal:repeat="day python:range(1,32)"
                    tal:content="day" tal:attributes="value day;
                      selected python:day == from_date_day or nothing" />
                </select>
                <select name="from_date_month">
                  <option tal:repeat="month python:range(1,13)"
                    tal:content="
                      python:mcat('_cal_Month%s' % (month, ));"
                    tal:attributes="
                      value month;
                      selected python:month == from_date_month or nothing"/>
                  </select>
                  <input name="from_date_year" size="4"
                  tal:attributes="value from_date_year" />
                <br>
                <tal:block replace="python:mcat('_cal_date_To_')">
                  To
                </tal:block>
                <select name="to_date_day">
                  <option tal:repeat="day python:range(1,32)"
                    tal:content="day" tal:attributes="value day;
                      selected python:day == to_date_day or nothing" />
                </select>
                <select name="to_date_month">
                  <option tal:repeat="month python:range(1,13)"
                    tal:content="
                      python:mcat('_cal_Month%s' % (month, ));"
                    tal:attributes="
                      value month;
                      selected python:month == to_date_month or nothing"/>
                </select>
                <input name="to_date_year" size="4"
                  tal:attributes="value to_date_year" />
              </tal:block>
              <tal:block condition="not:all_day"
                tal:define="
                  multi_day_event python:(from_date_day != to_date_day) or
                    (from_date_month != to_date_month) or
                    (from_date_year != to_date_year)">
                <input type="hidden" name="from_date_day"
                  tal:attributes="value from_date_day" />
                <input type="hidden" name="from_date_month"
                  tal:attributes="value from_date_month" />
                <input type="hidden" name="from_date_year"
                  tal:attributes="value from_date_year" />
                <input type="hidden" name="to_date_day"
                  tal:attributes="value to_date_day" />
                <input type="hidden" name="to_date_month"
                  tal:attributes="value to_date_month" />
                <input type="hidden" name="to_date_year"
                  tal:attributes="value to_date_year" />
                <h3>
                  <tal:block replace="python:mcat('_cal_Day_long%s' % (from_date.dow(), ))" />
                  <tal:block replace="from_date_day" />
                  <tal:block replace="python:mcat('_cal_Month%s' % (from_date_month, ))" />
                  <tal:block replace="from_date_year" />
                </h3>

                <tal:block replace="python:mcat('_cal_hour_From_')">
                  From
                </tal:block>
                <select name="from_date_hour">
                  <option tal:repeat="hour python:range(0,24)"
                    tal:content="hour" tal:attributes="value hour;
                      selected python:hour == from_date_hour or nothing" />
                </select><tal:block replace="python:mcat('_cal_hour_sep_')">:</tal:block><select name="from_date_minute">
                  <option tal:repeat="minute python:range(0,60,15)"
                    tal:content="minute" tal:attributes="value minute;
                      selected python:minute == from_date_minute or nothing" />
                </select>
                <br>
                <tal:block replace="python:mcat('_cal_hour_To_')">
                  To
                </tal:block>
                <select name="to_date_hour">
                  <option tal:repeat="hour python:range(0,24)"
                    tal:content="hour" tal:attributes="value hour;
                      selected python:hour == to_date_hour or nothing" />
                </select><tal:block replace="python:mcat('_cal_hour_sep_')">:</tal:block><select name="to_date_minute">
                  <option tal:repeat="minute python:range(0,60,15)"
                    tal:content="minute" tal:attributes="value minute;
                      selected python:minute == to_date_minute or nothing" />
                </select>
                <tal:block condition="multi_day_event">
                  (<tal:block
                    replace="
                      python:mcat('_cal_Day_long%s' % (to_date.dow(), ))" />
                  <tal:block replace="to_date_day" />
                  <tal:block
                    replace="
                      python:mcat('_cal_Month%s' % (to_date_month, ))" />
                  <tal:block replace="to_date_year" />)
                </tal:block>
              </tal:block>
            </metal:block>
          </metal:block>
          <metal:block use-macro="here/main_widgets/macros/form_property">
            <metal:block fill-slot="title"
              tal:content="python:mcat('_cal_prop_location_')">
              Location
            </metal:block>
            <metal:block fill-slot="content">
              <input name="location" size="40" tal:attributes="value location" />
            </metal:block>
          </metal:block>
          <metal:block use-macro="here/main_widgets/macros/form_property">
            <metal:block fill-slot="title"
              tal:content="python:mcat('_cal_prop_eventstatus_')">
              Event status
            </metal:block>
            <metal:block fill-slot="content">
              <select name="event_status"
                tal:define="
                  statuses python:['confirmed', 'unconfirmed', 'cancelled'];
                  statuses python:create and [status for status in statuses if status != 'cancelled'] or statuses">
                <option tal:repeat="status statuses"
                  tal:attributes="
                    value status;
                    selected python:status == event_status;
                  "
                  tal:content="python:mcat('_cal_eventstatus_%s_' % (status, ))">
                  status
                </option>
              </select>
            </metal:block>
          </metal:block>
          <metal:block use-macro="here/main_widgets/macros/form_property">
            <metal:block fill-slot="title"
              tal:content="python:mcat('_cal_prop_category_')">
            </metal:block>
            <metal:block fill-slot="content">
              <table width="100%" cellspacing="2" cellpadding="0" border="0">
                <tr tal:repeat="cat categories/items">
                  <td width="30" valign="middle">
                    <input type="radio" name="category"
                      tal:attributes="
                        value python:cat[0];
                       checked python:cat[0] == category;
                      " />
                  </td>
                  <td width="30" valign="middle">
                    <table cellpadding="0" cellspacing="0" width="80%"
                      height="10"
                      border="0"
                      tal:attributes="
                        bgcolor python:cat[1]['color']">
                      <tr>
                        <td>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td  valign="middle"
                    tal:content="python:mcat(cat[1]['title'])">
                    Category
                  </td>
                </tr>
              </table>
            </metal:block>
          </metal:block>
          <metal:block use-macro="here/main_widgets/macros/form_property">
            <metal:block fill-slot="title"
              tal:content="python:mcat('_cal_prop_transparent_')">
              Transparent
            </metal:block>
            <metal:block fill-slot="content">
              <select name="transparent:int"
                tal:define="choices python:[{'id': 1, 'title': '_Yes_'}, {'id':0, 'title': '_No_'}]">
                <option tal:repeat="choice choices"
                  tal:attributes="
                    value choice/id;
                    selected python:transparent == choice['id']"
                  tal:content="python:mcat(choice['title'])">
                  Yes
                </option>
                <p>
                  <small
                    tal:content="python:mcat('_Transparent events mean that you-re not busy during this event_')">
                    Transparent events mean that you're not busy during this event.
                  </small>
                </p>
              </select>
            </metal:block>
          </metal:block>
        </metal:block>
      </metal:block>
      <input type="submit" tal:attributes="value submit_value" />
      <input type="button" onClick="history.back()"
        tal:attributes="value python:mcat('_button_cancel_')" />
    </form>
  </tal:block>
  <form action="setMyStatus" tal:condition="python:not (create or editevent)">
    <h3
      tal:content="python:mcat('_Modify status for this event:')">
      Modify status for this event:
    </h3>
    <metal:block use-macro="here/main_widgets/macros/form">
      <metal:block fill-slot="content">
        <metal:block use-macro="here/main_widgets/macros/form_property">
          <metal:block fill-slot="title"
            tal:content="python:mcat('_cal_prop_status_')">
            Status
          </metal:block>
          <metal:block fill-slot="content">
            <select name="status"
              tal:define="myid python:here.getCalendar().id;
                mystatus python:[att for att in here.attendees if att['id'] == myid][0]['status']">
              <option tal:repeat="status python:['confirmed', 'tentative', 'decline']"
                tal:attributes="
                  value status;
                  selected python:status == mystatus"
                tal:content="python:mcat('_cal_pending_%s_' % (status,))">Status</option>
            </select>
          </metal:block>
        </metal:block>
        <metal:block use-macro="here/main_widgets/macros/form_property">
          <metal:block fill-slot="title"
            tal:content="python:mcat('_prop_comment_')">
            Comment
          </metal:block>
          <metal:block fill-slot="content">
            <textarea name="comment" cols="40" rows="4"></textarea>
          </metal:block>
        </metal:block>
      </metal:block>
    </metal:block>
    <input type="submit"
      tal:attributes="value python:mcat('_button_modify_')" />
    <input type="button" onClick="history.back()"
      tal:attributes="value python:mcat('_button_cancel_')" />
  </form>
</metal:block>

</html>
</tal:block>
